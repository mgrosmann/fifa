SELECT p.playerid, p.firstnameid, p.lastnameid, tpl.teamid, p.overallrating, p.potential
FROM players p
JOIN teamplayerlinks tpl ON tpl.playerid = p.playerid
JOIN leagueteamlinks ltl on tpl.teamid = ltl.teamid
WHERE tpl.teamid IN (
    21, 22, 32, 34, 44, 45, 46, 47, 48, 52, 65, 66, 73, 240, 241, 243, 461, 483, 110374
)
OR ltl.leagueid = 13
OR (
    p.overallrating >= 85 
    OR p.potential >= 85 
    OR (p.potential - p.overallrating) >= 15 
    
) AND tpl.teamid NOT IN (
974,1318,1319,1321,1322,1324,1325,1327,1328,1329,1330,1331,1332,1334,1335,1336,1337,1338,
1341,1342,1343,1352,1353,1354,1355,1356,1357,1359,1360,1361,1362,1363,1364,1365,1366,1367,
1369,1370,1375,1377,1383,1386,1387,1391,1393,1395,1411,1413,1415,1667,1886,105013,105022,
105035,110081,110082,111099,111107,111108,111109,111111,111112,111114,111115,111130,111448,
111451,111455,111456,111459,111461,111462,111465,111466,111473,111475,111481,111483,111487,
111489,111527,111545,111548,111550,111740,112048,111596,112606,112828,112190, 111205
      );


SELECT tpl.teamid,
       COUNT(DISTINCT p.playerid) AS nb_joueurs
FROM players p
JOIN teamplayerlinks tpl ON tpl.playerid = p.playerid
JOIN leagueteamlinks ltl ON tpl.teamid = ltl.teamid
WHERE tpl.teamid NOT IN (21, 22, 32, 34, 44, 45, 46, 47, 48, 52, 65, 66, 73, 240, 241, 243, 461, 483, 110374)
  AND ltl.leagueid != 13
  AND (
        p.overallrating >= 85
     OR p.potential >= 85
     OR (p.potential - p.overallrating) >= 15
  ) AND tpl.teamid NOT IN (
974,1318,1319,1321,1322,1324,1325,1327,1328,1329,1330,1331,1332,1334,1335,1336,1337,1338,
1341,1342,1343,1352,1353,1354,1355,1356,1357,1359,1360,1361,1362,1363,1364,1365,1366,1367,
1369,1370,1375,1377,1383,1386,1387,1391,1393,1395,1411,1413,1415,1667,1886,105013,105022,
105035,110081,110082,111099,111107,111108,111109,111111,111112,111114,111115,111130,111448,
111451,111455,111456,111459,111461,111462,111465,111466,111473,111475,111481,111483,111487,
111489,111527,111545,111548,111550,111740,112048,111596,112606,112828,112190, 111205
      )
GROUP BY tpl.teamid
ORDER BY nb_joueurs DESC;



